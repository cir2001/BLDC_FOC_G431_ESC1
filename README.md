# BLDC_FOC_G431_ESC1
## 2026-01-01 V0.0 初始化
- ESC1开发板 LED UART2上位机发送
## 2026-01-11 V0.1 闭环转动 初步测试
- ESC1开发板 模拟SPI采集AS5407P磁编码器位置，电机转动，初步
## 2026-01-12 V0.1 电压FOC 基础
- TIM1中断里，实现开环测试，电压FOC测试，闭环不带SVPWM_Output_Standard测试，标准  SVPWM 开环测试；SVPWM_Output_Standard (Min-Max 法)测试
- 实现速度环控制PID，给定vq，实现速度的控制   
## 2026-01-14 V0.1 OPAMP测试 通过
- OPAMP初始化代码，测试通过
## 2026-01-14 V0.1 电流FOC PID 首次转动
- 电流FOC PID 首次转动
## 2026-01-14 V0.1 电流FOC PID 调整参数 转动
- 电流FOC PID 电机频率15KHz
  -- 调试记录:
  1. 先电压开环FOC，电机控制频率不要太高，arr=42500，Vq设定初值，根据电机的timer频率调整，vd=0,让电机先转起来，验证极性是否正确
  2. 在电压foc能转动，但是进入电流focPID后电机抖动，可能是安培量级的问题，电压开环下，Vd=1.0f，vq=0.0f，输出打印观察printf("debug_iq:%.2f\r\n", debug_iq);找到缩放比例
  3. 先在42500下让电流FOC PID转起来，然后调整arr=5666，同时调整P，I的值，同时修改target_Vq。
  4. 暂时能想到这么多.....
## 2026-01-14 V0.2 速度环PID 前准备
- 速度环调试前的备份，重新整理的代码，删除了电流环调试时的一些打印输出
## 2026-01-18 V0.3 对V0.2的修正
- v0.2中，id和iq输出值有问题，电流环无法跟踪给定vq
- 本版本修正了初始电角度的偏差，对其进行补偿在FOC_Align_Sensor(void) 中 修正 manual_adjust = -20;
  -- 调试记录:
  1.先开环给vd=0.3，vq=0.0，看id和iq输出，需iq尽量接近0，调整合适的manual_adjust
  2.闭环调试电流环，只要电角度测量准确，修正偏差极可能的小，电机就能在闭环下旋转
  3.这步需要注意的：上电自启动，需先打开TIM1->BDTR |= TIM_BDTR_MOE;再进入启动步骤，启动过程中观察电源电流的输出，应有比较大的电流输出，如没有，功率管未工作。
- 速度环调试前的备份，重新整理的代码
## 2026-01-18 V0.3.1 开环找电角度零位
- main中将run_foc_flag = 0;Vd = 0.5f;Vq = 0.0f;，屏蔽timmer中断的所有pid计算，修改FOC_Align_Sensor(void)的manual_adjust，观察电机静态下id和iq的输出，iq在0附近，id在1.0附近
- 同时确认iu，iv，iw除去的系数，
## 2026-01-18 V0.3.2 重新找零位备份
## 2026-01-18 V0.3.3 电流环FOC PID控制 初步
- 电流环FOC PID控制 初步实现，极性正确，低iq噪声大
- ADC采样时机示波器观测前备份
## 2026-01-18 V0.3.3 VOFA输出波形
## 2026-01-26 V0.3.4 DMA输出VOFA显示
- DMA双缓冲方式
## 2026-01-26 V0.3.5 电流环PID 初步
## 2026-01-28 V0.3.5 更换as5047P采集方式备份
- 将原先模拟SPI方式，更改为ABI方式
## 2026-02-02 V0.3.6 MT6826S-STD 测试
- MT6826S-STD 模拟SPI 寄存器设置与读取，修改ABI输出
- G431的PB8，无法配置成硬件index复位，index只支持tim_etr引脚，需要注意
## 2026-02-02 V0.4.0 速度环 PID 初步 
## 2026-02-04 V0.4.1 未知电机极对数的测试
- 在align.c中增加未知极对数的电机测试极对数的代码
## 2026-02-05 V0.4.2 小修正，UVW相svpwm输出
- 重新校准UVW相电流，svpwm输出的代码，线序，更换绿色小云台电机